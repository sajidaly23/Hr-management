"use strict";(()=>{var e={};e.id=873,e.ids=[873],e.modules={1185:e=>{e.exports=require("mongoose")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},2781:e=>{e.exports=require("stream")},3837:e=>{e.exports=require("util")},6353:(e,r,o)=>{o.r(r),o.d(r,{headerHooks:()=>O,originalPathname:()=>j,patchFetch:()=>q,requestAsyncStorage:()=>w,routeModule:()=>S,serverHooks:()=>y,staticGenerationAsyncStorage:()=>x,staticGenerationBailout:()=>R});var t={};o.r(t),o.d(t,{POST:()=>f,runtime:()=>g});var n=o(884),s=o(6132),a=o(1040),i=o(5798),l=o(2421),u=o.n(l),c=o(6721),d=o.n(c),m=o(9919),p=o(8572);let g="nodejs",h=process.env.JWT_SECRET||"dev-secret-key",v=process.env.JWT_EXPIRES_IN||"7d";async function f(e){try{await (0,m.u)();let r=await e.json(),{email:o,password:t}=r||{};if(!o||!t)return i.Z.json({success:!1,message:"Email and password are required"},{status:400});let n=await p.n.findOne({email:o});if(!n)return i.Z.json({success:!1,message:"Invalid email or password"},{status:401});let s=await u().compare(t,n.passwordHash);if(!s)return i.Z.json({success:!1,message:"Invalid email or password"},{status:401});if(!n.isActive)return i.Z.json({success:!1,message:"Account is deactivated"},{status:403});let a=function(e){let r={id:e.id,email:e.email,role:e.role};return d().sign(r,h,{expiresIn:v})}({id:n.id,email:n.email,role:n.role});return i.Z.json({success:!0,data:{token:a,user:n.toSafeObject()}})}catch(r){console.error("Login error",r);let e="Internal server error";return"MongooseServerSelectionError"===r.name||r.message?.includes("ECONNREFUSED")?(e="Database connection failed. Please check your MongoDB configuration in .env.local",console.error("MongoDB connection error - is MongoDB running or is MONGODB_URI correct?")):r.message&&(e=r.message),i.Z.json({success:!1,message:e},{status:500})}}let S=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/auth/login/route",pathname:"/api/auth/login",filename:"route",bundlePath:"app/api/auth/login/route"},resolvedPagePath:"D:\\backend-1stproject\\HR-management\\front end\\src\\app\\api\\auth\\login\\route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:w,staticGenerationAsyncStorage:x,serverHooks:y,headerHooks:O,staticGenerationBailout:R}=S,j="/api/auth/login/route";function q(){return(0,a.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:x})}},9919:(e,r,o)=>{o.d(r,{u:()=>i});var t=o(1185),n=o.n(t);let s=process.env.MONGODB_URI||"mongodb://localhost:27017/hr_management";if((s.includes("username:password")||s.includes("cluster0.xxxxx"))&&(console.error("⚠️  ERROR: MongoDB URI is still using placeholder values!"),console.error("Please update .env.local with your actual MongoDB Atlas connection string."),console.error("See MONGODB_SETUP.md for instructions.")),!s)throw Error("Please define the MONGODB_URI environment variable in .env.local");let a=global.mongoose;async function i(){return a.conn||(a.promise||(a.promise=n().connect(s).then(e=>e)),a.conn=await a.promise),a.conn}a||(a=global.mongoose={conn:null,promise:null})},8572:(e,r,o)=>{o.d(r,{n:()=>a});var t=o(1185),n=o.n(t);let s=new t.Schema({name:{type:String,required:!0},email:{type:String,required:!0,unique:!0,lowercase:!0,trim:!0},passwordHash:{type:String,required:!0},role:{type:String,enum:["super_admin","admin","employee"],default:"employee"},isActive:{type:Boolean,default:!0}},{timestamps:!0});s.methods.toSafeObject=function(){return{id:this._id.toString(),name:this.name,email:this.email,role:this.role,isActive:this.isActive}};let a=n().models.User||n().model("User",s)}};var r=require("../../../../webpack-runtime.js");r.C(e);var o=e=>r(r.s=e),t=r.X(0,[271,910],()=>o(6353));module.exports=t})();